"0","#python"
"0","def IMM_process(Data,peptide):"
"0","    sam_pep_ID = Data[""pep_ID""].unique()"
"0","    res = []"
"0","    p_ID = []"
"0","    Data[""length""] = Data[""pep""].map(len)"
"0","    for a in sam_pep_ID:"
"0","        Mean = []    "
"0","        ID = Data[Data[""pep_ID""] == a]"
"0","        for i in ID[""HLA""].unique():"
"0","            Data_HLA = ID[ID[""HLA""] == i]"
"0","            prediction = []"
"0","            for l in Data_HLA[""length""].unique():"
"0","                Data_len = Data_HLA[Data_HLA[""length""] == l]"
"0","                pre = Data_len[""prediction""].max()"
"0","                prediction.append(pre)"
"0","            x = np.max(prediction)"
"0","            Mean.append(x)"
"0","        res.append(max(Mean))"
"0","        p_ID.append(a)"
"0","    result = pd.DataFrame({""pep_ID"":p_ID,""prediction"":res})"
"0","    result = result.merge(peptide,how = ""inner"",on = ""pep_ID"" )"
"0","    return result"
"0","  "
"0","def auc_pr(data,true_label,prediction,rank = False):"
"0","    if rank:"
"0","        fpr,tpr,_ = roc_curve(data[true_label],1-data[prediction])"
"0","        precision,recall,_ = precision_recall_curve(data[true_label],1-data[prediction])"
"0","    else:"
"0","        fpr,tpr,_ = roc_curve(data[true_label],data[prediction])"
"0","        precision,recall,_ = precision_recall_curve(data[true_label],data[prediction])"
"0","        "
"0","    AUC = auc(fpr,tpr)"
"0","    PR = auc(recall,precision)"
"0","    "
"0","    return fpr,tpr,recall,precision,AUC,PR"
"0","  "
"0","result = pd.read_csv(""../data/15mer_result.csv"")"
"0","result_15mer = IMM_process(result,peptide)"
"0","mer15_result = auc_pr(result_15mer,""Immunogenicity"",""prediction"")"
"0","print(""AUC:{}"".format(mer15_result[4]))"
"1","AUC:0.7332489451476794
"
"0","print(""PR_AUC:{}"".format(mer15_result[5]))"
"1","PR_AUC:0.198391863815141
"
